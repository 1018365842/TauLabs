\hypertarget{heap_8c}{\section{/home/jose/\-Code/gui\-Tau/flight/\-Libraries/\-Py\-Mite/vm/heap.c File Reference}
\label{heap_8c}\index{/home/jose/\-Code/gui\-Tau/flight/\-Libraries/\-Py\-Mite/vm/heap.\-c@{/home/jose/\-Code/gui\-Tau/flight/\-Libraries/\-Py\-Mite/vm/heap.\-c}}
}


V\-M Heap.  


\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_pm_heap_desc__s}{Pm\-Heap\-Desc\-\_\-s}
\item 
struct \hyperlink{struct_pm_heap__s}{Pm\-Heap\-\_\-s}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{struct_pm_heap_desc__s}{Pm\-Heap\-Desc\-\_\-s} \hyperlink{heap_8c_aeabd4affb399e9d0466b67971ee0c2e4}{Pm\-Heap\-Desc\-\_\-t}
\item 
typedef struct \hyperlink{struct_pm_heap_desc__s}{Pm\-Heap\-Desc\-\_\-s} $\ast$ \hyperlink{heap_8c_a58577aaeb605da8ad6db3900dbb9a7b8}{p\-Pm\-Heap\-Desc\-\_\-t}
\item 
typedef struct \hyperlink{struct_pm_heap__s}{Pm\-Heap\-\_\-s} \hyperlink{heap_8c_ab19624850c49f31f5660ff6211baa40e}{Pm\-Heap\-\_\-t}
\item 
typedef struct \hyperlink{struct_pm_heap__s}{Pm\-Heap\-\_\-s} $\ast$ \hyperlink{heap_8c_a25c793b67d07b500f213ac356f2fe296}{p\-Pm\-Heap\-\_\-t}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{heap_8c_af75e64558888d6e7212b81a8886949a3}{heap\-\_\-init} (\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void})
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{heap_8c_ad73bb5541b67b59d755fe54bda05767a}{heap\-\_\-get\-Chunk} (\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\-\_\-t} requestedsize, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} $\ast$$\ast$r\-\_\-pchunk)
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{heap_8c_a2349e34d639dbf35543eaec9c0f74376}{heap\-\_\-free\-Chunk} (\hyperlink{obj_8h_af293479fa3f9d92b941ee7445ad3960e}{p\-Pm\-Obj\-\_\-t} ptr)
\item 
\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} \hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\-\_\-t} \hyperlink{heap_8c_ad9929ee2da84f6a3c04e5c876b3f718b}{heap\-\_\-get\-Avail} (\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void})
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{heap_8c_af7a82b1330a1c45e2afa61ba4937c40d}{heap\-\_\-gc\-Run} (\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void})
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{heap_8c_a895d63b2fe3af97eda0b1dfdb9414d71}{heap\-\_\-gc\-Set\-Auto} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} auto\-\_\-gc)
\item 
\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void} \hyperlink{heap_8c_a3207a43d25b20cf8e04c1021d444d47b}{heap\-\_\-gc\-Push\-Temp\-Root} (\hyperlink{obj_8h_af293479fa3f9d92b941ee7445ad3960e}{p\-Pm\-Obj\-\_\-t} pobj, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} $\ast$r\-\_\-objid)
\item 
\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void} \hyperlink{heap_8c_ae8397e0d2ecc2b4eba7e849d5bc7e754}{heap\-\_\-gc\-Pop\-Temp\-Root} (\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} objid)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
V\-M Heap. V\-M heap operations. All of Py\-Mite's dynamic memory is obtained from this heap. The heap provides dynamic memory on demand. 

Definition in file \hyperlink{heap_8c_source}{heap.\-c}.



\subsection{Typedef Documentation}
\hypertarget{heap_8c_ab19624850c49f31f5660ff6211baa40e}{\index{heap.\-c@{heap.\-c}!Pm\-Heap\-\_\-t@{Pm\-Heap\-\_\-t}}
\index{Pm\-Heap\-\_\-t@{Pm\-Heap\-\_\-t}!heap.c@{heap.\-c}}
\subsubsection[{Pm\-Heap\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf Pm\-Heap\-\_\-s}  {\bf Pm\-Heap\-\_\-t}}}\label{heap_8c_ab19624850c49f31f5660ff6211baa40e}
\hypertarget{heap_8c_aeabd4affb399e9d0466b67971ee0c2e4}{\index{heap.\-c@{heap.\-c}!Pm\-Heap\-Desc\-\_\-t@{Pm\-Heap\-Desc\-\_\-t}}
\index{Pm\-Heap\-Desc\-\_\-t@{Pm\-Heap\-Desc\-\_\-t}!heap.c@{heap.\-c}}
\subsubsection[{Pm\-Heap\-Desc\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf Pm\-Heap\-Desc\-\_\-s}  {\bf Pm\-Heap\-Desc\-\_\-t}}}\label{heap_8c_aeabd4affb399e9d0466b67971ee0c2e4}
The following is a diagram of the heap descriptor at the head of the chunk\-: \begin{DoxyVerb}*                MSb          LSb
*                7 6 5 4 3 2 1 0
*      pchunk-> +-+-+-+-+-+-+-+-+
*               |     S[9:2]    |     S := Size of the chunk (2 LSbs dropped)
*               +-+-+-----------+     F := Chunk free bit (not in use)
*               |F|R| S[15:10]  |     R := Bit reserved for future use
*               +-+-+-----------+
*               |     P(L)      |     P := hd_prev: Pointer to previous node
*               |     P(H)      |     N := hd_next: Pointer to next node
*               |     N(L)      |
*               |     N(H)      |     Theoretical min size == 6
*               +---------------+     Effective min size == 8
*               | unused space  |     (12 on 32-bit MCUs)
*               ...           ...
*               | end chunk     |
*               +---------------+
* \end{DoxyVerb}
 \hypertarget{heap_8c_a25c793b67d07b500f213ac356f2fe296}{\index{heap.\-c@{heap.\-c}!p\-Pm\-Heap\-\_\-t@{p\-Pm\-Heap\-\_\-t}}
\index{p\-Pm\-Heap\-\_\-t@{p\-Pm\-Heap\-\_\-t}!heap.c@{heap.\-c}}
\subsubsection[{p\-Pm\-Heap\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf Pm\-Heap\-\_\-s}
 $\ast$ {\bf p\-Pm\-Heap\-\_\-t}}}\label{heap_8c_a25c793b67d07b500f213ac356f2fe296}
\hypertarget{heap_8c_a58577aaeb605da8ad6db3900dbb9a7b8}{\index{heap.\-c@{heap.\-c}!p\-Pm\-Heap\-Desc\-\_\-t@{p\-Pm\-Heap\-Desc\-\_\-t}}
\index{p\-Pm\-Heap\-Desc\-\_\-t@{p\-Pm\-Heap\-Desc\-\_\-t}!heap.c@{heap.\-c}}
\subsubsection[{p\-Pm\-Heap\-Desc\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf Pm\-Heap\-Desc\-\_\-s}
 $\ast$ {\bf p\-Pm\-Heap\-Desc\-\_\-t}}}\label{heap_8c_a58577aaeb605da8ad6db3900dbb9a7b8}


\subsection{Function Documentation}
\hypertarget{heap_8c_a2349e34d639dbf35543eaec9c0f74376}{\index{heap.\-c@{heap.\-c}!heap\-\_\-free\-Chunk@{heap\-\_\-free\-Chunk}}
\index{heap\-\_\-free\-Chunk@{heap\-\_\-free\-Chunk}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-free\-Chunk}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} heap\-\_\-free\-Chunk (
\begin{DoxyParamCaption}
\item[{{\bf p\-Pm\-Obj\-\_\-t}}]{ptr}
\end{DoxyParamCaption}
)}}\label{heap_8c_a2349e34d639dbf35543eaec9c0f74376}
Places the chunk back in the heap.


\begin{DoxyParams}{Parameters}
{\em ptr} & Pointer to object to free. \\
\hline
\end{DoxyParams}


Definition at line 549 of file heap.\-c.

\hypertarget{heap_8c_ae8397e0d2ecc2b4eba7e849d5bc7e754}{\index{heap.\-c@{heap.\-c}!heap\-\_\-gc\-Pop\-Temp\-Root@{heap\-\_\-gc\-Pop\-Temp\-Root}}
\index{heap\-\_\-gc\-Pop\-Temp\-Root@{heap\-\_\-gc\-Pop\-Temp\-Root}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-gc\-Pop\-Temp\-Root}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} heap\-\_\-gc\-Pop\-Temp\-Root (
\begin{DoxyParamCaption}
\item[{{\bf uint8\-\_\-t}}]{objid}
\end{DoxyParamCaption}
)}}\label{heap_8c_ae8397e0d2ecc2b4eba7e849d5bc7e754}
Pops from the temporary roots stack all objects upto and including the one denoted by the given I\-D


\begin{DoxyParams}{Parameters}
{\em objid} & I\-D of object to pop \\
\hline
\end{DoxyParams}


Definition at line 1176 of file heap.\-c.

\hypertarget{heap_8c_a3207a43d25b20cf8e04c1021d444d47b}{\index{heap.\-c@{heap.\-c}!heap\-\_\-gc\-Push\-Temp\-Root@{heap\-\_\-gc\-Push\-Temp\-Root}}
\index{heap\-\_\-gc\-Push\-Temp\-Root@{heap\-\_\-gc\-Push\-Temp\-Root}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-gc\-Push\-Temp\-Root}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} heap\-\_\-gc\-Push\-Temp\-Root (
\begin{DoxyParamCaption}
\item[{{\bf p\-Pm\-Obj\-\_\-t}}]{pobj, }
\item[{{\bf uint8\-\_\-t} $\ast$}]{r\-\_\-objid}
\end{DoxyParamCaption}
)}}\label{heap_8c_a3207a43d25b20cf8e04c1021d444d47b}
Pushes an object onto the temporary roots stack if there is room to protect the objects from a potential garbage collection


\begin{DoxyParams}{Parameters}
{\em pobj} & Object to push onto the roots stack \\
\hline
{\em r\-\_\-objid} & By reference; I\-D to use when popping the object from the stack \\
\hline
\end{DoxyParams}


Definition at line 1164 of file heap.\-c.

\hypertarget{heap_8c_af7a82b1330a1c45e2afa61ba4937c40d}{\index{heap.\-c@{heap.\-c}!heap\-\_\-gc\-Run@{heap\-\_\-gc\-Run}}
\index{heap\-\_\-gc\-Run@{heap\-\_\-gc\-Run}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-gc\-Run}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} heap\-\_\-gc\-Run (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{heap_8c_af7a82b1330a1c45e2afa61ba4937c40d}
Runs the mark-\/sweep garbage collector

\begin{DoxyReturn}{Returns}
Return code 
\end{DoxyReturn}


Definition at line 1134 of file heap.\-c.

\hypertarget{heap_8c_a895d63b2fe3af97eda0b1dfdb9414d71}{\index{heap.\-c@{heap.\-c}!heap\-\_\-gc\-Set\-Auto@{heap\-\_\-gc\-Set\-Auto}}
\index{heap\-\_\-gc\-Set\-Auto@{heap\-\_\-gc\-Set\-Auto}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-gc\-Set\-Auto}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} heap\-\_\-gc\-Set\-Auto (
\begin{DoxyParamCaption}
\item[{{\bf uint8\-\_\-t}}]{auto\-\_\-gc}
\end{DoxyParamCaption}
)}}\label{heap_8c_a895d63b2fe3af97eda0b1dfdb9414d71}
Enables (if true) or disables automatic garbage collection


\begin{DoxyParams}{Parameters}
{\em bool} & Value to enable or disable auto G\-C \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Return code 
\end{DoxyReturn}


Definition at line 1158 of file heap.\-c.

\hypertarget{heap_8c_ad9929ee2da84f6a3c04e5c876b3f718b}{\index{heap.\-c@{heap.\-c}!heap\-\_\-get\-Avail@{heap\-\_\-get\-Avail}}
\index{heap\-\_\-get\-Avail@{heap\-\_\-get\-Avail}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-get\-Avail}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint32\-\_\-t} {\bf uint16\-\_\-t} heap\-\_\-get\-Avail (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{heap_8c_ad9929ee2da84f6a3c04e5c876b3f718b}
\begin{DoxyReturn}{Returns}
Return number of bytes available in the heap 
\end{DoxyReturn}


Definition at line 578 of file heap.\-c.

\hypertarget{heap_8c_ad73bb5541b67b59d755fe54bda05767a}{\index{heap.\-c@{heap.\-c}!heap\-\_\-get\-Chunk@{heap\-\_\-get\-Chunk}}
\index{heap\-\_\-get\-Chunk@{heap\-\_\-get\-Chunk}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-get\-Chunk}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} heap\-\_\-get\-Chunk (
\begin{DoxyParamCaption}
\item[{{\bf uint16\-\_\-t}}]{requestedsize, }
\item[{{\bf uint8\-\_\-t} $\ast$$\ast$}]{r\-\_\-pchunk}
\end{DoxyParamCaption}
)}}\label{heap_8c_ad73bb5541b67b59d755fe54bda05767a}
Returns a free chunk from the heap.

The chunk will be at least the requested size. The actual size can be found in the return chunk's od.\-od\-\_\-size.


\begin{DoxyParams}{Parameters}
{\em requestedsize} & Requested size of the chunk in bytes. \\
\hline
{\em r\-\_\-pchunk} & Addr of ptr to chunk (return). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Return code 
\end{DoxyReturn}


Definition at line 498 of file heap.\-c.

\hypertarget{heap_8c_af75e64558888d6e7212b81a8886949a3}{\index{heap.\-c@{heap.\-c}!heap\-\_\-init@{heap\-\_\-init}}
\index{heap\-\_\-init@{heap\-\_\-init}!heap.c@{heap.\-c}}
\subsubsection[{heap\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} heap\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{heap_8c_af75e64558888d6e7212b81a8886949a3}
Initializes the heap for use.

\begin{DoxyReturn}{Returns}
nothing. 
\end{DoxyReturn}


Definition at line 352 of file heap.\-c.

