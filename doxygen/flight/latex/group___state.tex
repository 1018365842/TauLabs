\hypertarget{group___state}{\section{State Module}
\label{group___state}\index{State Module@{State Module}}
}


Acquires sensor data and computes attitude estimate Specifically updates the the Attitude\-Actual and Attitude\-Raw settings objects.  


\subsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \hyperlink{state_8h}{state.\-h}
\begin{DoxyCompactList}\small\item\em Acquires sensor data and fuses it into attitude estimate for C\-C. \end{DoxyCompactList}\item 
file \hyperlink{state_8h}{state.\-h}
\begin{DoxyCompactList}\small\item\em Acquires sensor data and fuses it into attitude estimate for C\-C. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_global_attitude_variables}{Global\-Attitude\-Variables}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{struct_global_attitude_variables}{Global\-Attitude\-Variables} \hyperlink{group___state_ga02f6c6dfdf0ff8ff2b30b24205c6b1f8}{Global\-Attitude\-Variables}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group___n_a_m_e_gafd12020da5a235dfcf0c3c748fb5baed}{int32\-\_\-t} \hyperlink{group___state_ga9b5b60f1575dfa72f03b42b503e9095c}{State\-Start} (\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void})
\item 
\hyperlink{group___n_a_m_e_gafd12020da5a235dfcf0c3c748fb5baed}{int32\-\_\-t} \hyperlink{group___state_gad59daafb348cfa8a33ce1d08eb2f8e5b}{State\-Initialize} (\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void})
\item 
\hyperlink{group___state_gac687f4ea48d6390c8854b0a5a1250752}{M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L} (\hyperlink{group___state_gad59daafb348cfa8a33ce1d08eb2f8e5b}{State\-Initialize}, \hyperlink{group___state_ga9b5b60f1575dfa72f03b42b503e9095c}{State\-Start})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
float \hyperlink{group___state_ga0a9a06d18d9d208192de6edeed98fbe8}{Global\-Attitude\-Variables\-::accel\-Ki}
\begin{DoxyCompactList}\small\item\em How fast to estimate the gyro bias. \end{DoxyCompactList}\item 
float \hyperlink{group___state_gaf9246ddec8582b6b47b752019c29b2e4}{Global\-Attitude\-Variables\-::accel\-Kp}
\begin{DoxyCompactList}\small\item\em How much to change the attitude based on accelerometer data. \end{DoxyCompactList}\item 
float \hyperlink{group___state_ga0c53c008608a5724b2d563fd5b560905}{Global\-Attitude\-Variables\-::yaw\-Bias\-Rate}
\begin{DoxyCompactList}\small\item\em Sets the rate when assuming that average yaw is zero to null out yaw error. \end{DoxyCompactList}\item 
float \hyperlink{group___state_gac754011cf55a0c78cb770e48567802ba}{Global\-Attitude\-Variables\-::gyro\-\_\-correct\-\_\-int} \mbox{[}3\mbox{]}
\begin{DoxyCompactList}\small\item\em Current etimate of the gyro bias. \end{DoxyCompactList}\item 
float \hyperlink{group___state_ga34a6662a3aea49780925afa629a917cf}{Global\-Attitude\-Variables\-::q} \mbox{[}4\mbox{]}
\begin{DoxyCompactList}\small\item\em Local copy of current estimate of the attitude. \end{DoxyCompactList}\item 
float \hyperlink{group___state_ga45b3fda0427f0fab27b88df83ae9108d}{Global\-Attitude\-Variables\-::\-T} \mbox{[}3\mbox{]}
\begin{DoxyCompactList}\small\item\em Transformation from L\-L\-A to N\-E\-D. \end{DoxyCompactList}\item 
\hyperlink{group___exported__types_gaf6a258d8f3ee5206d682d799316314b1}{bool} \hyperlink{group___state_gad5da7bf77c18e9d5990d4b6d6f28477e}{Global\-Attitude\-Variables\-::rotate}
\begin{DoxyCompactList}\small\item\em Whether to rotate data from the sensor board frame to the body frame (if the frames are different) \end{DoxyCompactList}\item 
float \hyperlink{group___state_ga6c34048525801ac0e7e26eb733c759d5}{Global\-Attitude\-Variables\-::\-Rbs} \mbox{[}3\mbox{]}\mbox{[}3\mbox{]}
\begin{DoxyCompactList}\small\item\em Rotation matrix that transforms from the sensor board frame to the body frame. \end{DoxyCompactList}\item 
\hyperlink{group___exported__types_gaf6a258d8f3ee5206d682d799316314b1}{bool} \hyperlink{group___state_gaa625401f5bc69c19b54b3171703f37f9}{Global\-Attitude\-Variables\-::zero\-\_\-during\-\_\-arming}
\begin{DoxyCompactList}\small\item\em Indicates to estimate the gyro bias again while arming (faster convergence) \end{DoxyCompactList}\item 
\hyperlink{group___exported__types_gaf6a258d8f3ee5206d682d799316314b1}{bool} \hyperlink{group___state_ga3df4e05bd900b439ad746cbadce667d5}{Global\-Attitude\-Variables\-::bias\-\_\-correct\-\_\-gyro}
\begin{DoxyCompactList}\small\item\em Whether to apply the estimate of gyro bias to the data in the U\-A\-V\-O. \end{DoxyCompactList}\item 
\hyperlink{group___exported__types_gaf6a258d8f3ee5206d682d799316314b1}{bool} \hyperlink{group___state_ga1b90881e0b0eb5aa9cf39d0ba8ef5e0d}{Global\-Attitude\-Variables\-::trim\-\_\-requested}
\item 
float \hyperlink{group___state_ga8941c16a263cb020587ef58dd38f8281}{Global\-Attitude\-Variables\-::trim\-\_\-accels} \mbox{[}3\mbox{]}
\begin{DoxyCompactList}\small\item\em Accumulator for the accel data during trimming. \end{DoxyCompactList}\item 
\hyperlink{group___n_a_m_e_gafd12020da5a235dfcf0c3c748fb5baed}{int32\-\_\-t} \hyperlink{group___state_ga9e5b2790cd84db83278b3c8c289ea411}{Global\-Attitude\-Variables\-::trim\-\_\-samples}
\begin{DoxyCompactList}\small\item\em Counter of how many accel samples have been accumulated. \end{DoxyCompactList}\item 
struct \hyperlink{struct_global_attitude_variables}{Global\-Attitude\-Variables} $\ast$ \hyperlink{group___state_ga76682d72011dc0109f1d5cf25a6c6da0}{glbl\-Att}
\item 
Sensor\-Settings\-Data \hyperlink{group___state_ga7e2b26cdc0322ab9457559aa2b94f8fc}{sensor\-Settings}
\item 
Attitude\-Settings\-Data \hyperlink{group___state_ga8f6543ab52bafea6c0858baeeae8db59}{attitude\-Settings}
\item 
Gyros\-Bias\-Data \hyperlink{group___state_ga233a2d6850e9c466f80ae6bb2ebd98e8}{gyros\-Bias}
\item 
\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\-\_\-t} \hyperlink{group___n_a_m_e_ga7ae6d0e43244213b34de2c2b9aa30da6}{const} \hyperlink{group___state_ga6faaeb7ea10f4d232ea751bdcebb3aef}{M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S} = 65535
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Acquires sensor data and computes attitude estimate Specifically updates the the Attitude\-Actual and Attitude\-Raw settings objects. 

\subsection{Typedef Documentation}
\hypertarget{group___state_ga02f6c6dfdf0ff8ff2b30b24205c6b1f8}{\index{State Module@{State Module}!Global\-Attitude\-Variables@{Global\-Attitude\-Variables}}
\index{Global\-Attitude\-Variables@{Global\-Attitude\-Variables}!State Module@{State Module}}
\subsubsection[{Global\-Attitude\-Variables}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf Global\-Attitude\-Variables} {\bf Global\-Attitude\-Variables}}}\label{group___state_ga02f6c6dfdf0ff8ff2b30b24205c6b1f8}


Definition at line 68 of file state\-\_\-struct.\-h.



\subsection{Function Documentation}
\hypertarget{group___state_gac687f4ea48d6390c8854b0a5a1250752}{\index{State Module@{State Module}!M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L@{M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L}}
\index{M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L@{M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L}!State Module@{State Module}}
\subsubsection[{M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L}]{\setlength{\rightskip}{0pt plus 5cm}M\-O\-D\-U\-L\-E\-\_\-\-I\-N\-I\-T\-C\-A\-L\-L (
\begin{DoxyParamCaption}
\item[{{\bf State\-Initialize}}]{, }
\item[{{\bf State\-Start}}]{}
\end{DoxyParamCaption}
)}}\label{group___state_gac687f4ea48d6390c8854b0a5a1250752}


Definition at line 203 of file state.\-c.

\hypertarget{group___state_gad59daafb348cfa8a33ce1d08eb2f8e5b}{\index{State Module@{State Module}!State\-Initialize@{State\-Initialize}}
\index{State\-Initialize@{State\-Initialize}!State Module@{State Module}}
\subsubsection[{State\-Initialize}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int32\-\_\-t} State\-Initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{group___state_gad59daafb348cfa8a33ce1d08eb2f8e5b}
Initialise the module, called on startup \begin{DoxyReturn}{Returns}
0 on success or -\/1 if initialisation failed 
\end{DoxyReturn}


Definition at line 145 of file state.\-c.

\hypertarget{group___state_ga9b5b60f1575dfa72f03b42b503e9095c}{\index{State Module@{State Module}!State\-Start@{State\-Start}}
\index{State\-Start@{State\-Start}!State Module@{State Module}}
\subsubsection[{State\-Start}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int32\-\_\-t} State\-Start (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{group___state_ga9b5b60f1575dfa72f03b42b503e9095c}
Initialise the module, called on startup \begin{DoxyReturn}{Returns}
0 on success or -\/1 if initialisation failed 
\end{DoxyReturn}


Definition at line 129 of file state.\-c.



\subsection{Variable Documentation}
\hypertarget{group___state_ga0a9a06d18d9d208192de6edeed98fbe8}{\index{State Module@{State Module}!accel\-Ki@{accel\-Ki}}
\index{accel\-Ki@{accel\-Ki}!State Module@{State Module}}
\subsubsection[{accel\-Ki}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::accel\-Ki}}\label{group___state_ga0a9a06d18d9d208192de6edeed98fbe8}


How fast to estimate the gyro bias. 



Definition at line 40 of file state\-\_\-struct.\-h.

\hypertarget{group___state_gaf9246ddec8582b6b47b752019c29b2e4}{\index{State Module@{State Module}!accel\-Kp@{accel\-Kp}}
\index{accel\-Kp@{accel\-Kp}!State Module@{State Module}}
\subsubsection[{accel\-Kp}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::accel\-Kp}}\label{group___state_gaf9246ddec8582b6b47b752019c29b2e4}


How much to change the attitude based on accelerometer data. 



Definition at line 42 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga8f6543ab52bafea6c0858baeeae8db59}{\index{State Module@{State Module}!attitude\-Settings@{attitude\-Settings}}
\index{attitude\-Settings@{attitude\-Settings}!State Module@{State Module}}
\subsubsection[{attitude\-Settings}]{\setlength{\rightskip}{0pt plus 5cm}Attitude\-Settings\-Data attitude\-Settings}}\label{group___state_ga8f6543ab52bafea6c0858baeeae8db59}
U\-A\-V\-Objects are automatically generated by the U\-A\-V\-Object\-Generator from the object definition X\-M\-L file.

Modules have no A\-P\-I, all communication to other modules is done through U\-A\-V\-Objects. However modules may use the A\-P\-I exposed by shared libraries. See the Open\-Pilot wiki for more details. \href{http://www.openpilot.org/OpenPilot_Application_Architecture}{\tt http\-://www.\-openpilot.\-org/\-Open\-Pilot\-\_\-\-Application\-\_\-\-Architecture} 

Definition at line 94 of file state.\-c.

\hypertarget{group___state_ga3df4e05bd900b439ad746cbadce667d5}{\index{State Module@{State Module}!bias\-\_\-correct\-\_\-gyro@{bias\-\_\-correct\-\_\-gyro}}
\index{bias\-\_\-correct\-\_\-gyro@{bias\-\_\-correct\-\_\-gyro}!State Module@{State Module}}
\subsubsection[{bias\-\_\-correct\-\_\-gyro}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bool} Global\-Attitude\-Variables\-::bias\-\_\-correct\-\_\-gyro}}\label{group___state_ga3df4e05bd900b439ad746cbadce667d5}


Whether to apply the estimate of gyro bias to the data in the U\-A\-V\-O. 



Definition at line 58 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga76682d72011dc0109f1d5cf25a6c6da0}{\index{State Module@{State Module}!glbl\-Att@{glbl\-Att}}
\index{glbl\-Att@{glbl\-Att}!State Module@{State Module}}
\subsubsection[{glbl\-Att}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf Global\-Attitude\-Variables}$\ast$ glbl\-Att}}\label{group___state_ga76682d72011dc0109f1d5cf25a6c6da0}


Definition at line 92 of file state.\-c.

\hypertarget{group___state_gac754011cf55a0c78cb770e48567802ba}{\index{State Module@{State Module}!gyro\-\_\-correct\-\_\-int@{gyro\-\_\-correct\-\_\-int}}
\index{gyro\-\_\-correct\-\_\-int@{gyro\-\_\-correct\-\_\-int}!State Module@{State Module}}
\subsubsection[{gyro\-\_\-correct\-\_\-int}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::gyro\-\_\-correct\-\_\-int\mbox{[}3\mbox{]}}}\label{group___state_gac754011cf55a0c78cb770e48567802ba}


Current etimate of the gyro bias. 



Definition at line 46 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga233a2d6850e9c466f80ae6bb2ebd98e8}{\index{State Module@{State Module}!gyros\-Bias@{gyros\-Bias}}
\index{gyros\-Bias@{gyros\-Bias}!State Module@{State Module}}
\subsubsection[{gyros\-Bias}]{\setlength{\rightskip}{0pt plus 5cm}Gyros\-Bias\-Data gyros\-Bias}}\label{group___state_ga233a2d6850e9c466f80ae6bb2ebd98e8}


Definition at line 95 of file state.\-c.

\hypertarget{group___state_ga6faaeb7ea10f4d232ea751bdcebb3aef}{\index{State Module@{State Module}!M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S@{M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S}}
\index{M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S@{M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S}!State Module@{State Module}}
\subsubsection[{M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S}]{\setlength{\rightskip}{0pt plus 5cm}{\bf uint16\-\_\-t} {\bf const} M\-A\-X\-\_\-\-T\-R\-I\-M\-\_\-\-F\-L\-I\-G\-H\-T\-\_\-\-S\-A\-M\-P\-L\-E\-S = 65535}}\label{group___state_ga6faaeb7ea10f4d232ea751bdcebb3aef}


Definition at line 98 of file state.\-c.

\hypertarget{group___state_ga34a6662a3aea49780925afa629a917cf}{\index{State Module@{State Module}!q@{q}}
\index{q@{q}!State Module@{State Module}}
\subsubsection[{q}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::q\mbox{[}4\mbox{]}}}\label{group___state_ga34a6662a3aea49780925afa629a917cf}


Local copy of current estimate of the attitude. 



Definition at line 48 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga6c34048525801ac0e7e26eb733c759d5}{\index{State Module@{State Module}!Rbs@{Rbs}}
\index{Rbs@{Rbs}!State Module@{State Module}}
\subsubsection[{Rbs}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::\-Rbs\mbox{[}3\mbox{]}\mbox{[}3\mbox{]}}}\label{group___state_ga6c34048525801ac0e7e26eb733c759d5}


Rotation matrix that transforms from the sensor board frame to the body frame. 



Definition at line 54 of file state\-\_\-struct.\-h.

\hypertarget{group___state_gad5da7bf77c18e9d5990d4b6d6f28477e}{\index{State Module@{State Module}!rotate@{rotate}}
\index{rotate@{rotate}!State Module@{State Module}}
\subsubsection[{rotate}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bool} Global\-Attitude\-Variables\-::rotate}}\label{group___state_gad5da7bf77c18e9d5990d4b6d6f28477e}


Whether to rotate data from the sensor board frame to the body frame (if the frames are different) 



Definition at line 52 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga7e2b26cdc0322ab9457559aa2b94f8fc}{\index{State Module@{State Module}!sensor\-Settings@{sensor\-Settings}}
\index{sensor\-Settings@{sensor\-Settings}!State Module@{State Module}}
\subsubsection[{sensor\-Settings}]{\setlength{\rightskip}{0pt plus 5cm}Sensor\-Settings\-Data sensor\-Settings}}\label{group___state_ga7e2b26cdc0322ab9457559aa2b94f8fc}


Definition at line 93 of file state.\-c.

\hypertarget{group___state_ga45b3fda0427f0fab27b88df83ae9108d}{\index{State Module@{State Module}!T@{T}}
\index{T@{T}!State Module@{State Module}}
\subsubsection[{T}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::\-T\mbox{[}3\mbox{]}}}\label{group___state_ga45b3fda0427f0fab27b88df83ae9108d}


Transformation from L\-L\-A to N\-E\-D. 



Definition at line 50 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga8941c16a263cb020587ef58dd38f8281}{\index{State Module@{State Module}!trim\-\_\-accels@{trim\-\_\-accels}}
\index{trim\-\_\-accels@{trim\-\_\-accels}!State Module@{State Module}}
\subsubsection[{trim\-\_\-accels}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::trim\-\_\-accels\mbox{[}3\mbox{]}}}\label{group___state_ga8941c16a263cb020587ef58dd38f8281}


Accumulator for the accel data during trimming. 



Definition at line 63 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga1b90881e0b0eb5aa9cf39d0ba8ef5e0d}{\index{State Module@{State Module}!trim\-\_\-requested@{trim\-\_\-requested}}
\index{trim\-\_\-requested@{trim\-\_\-requested}!State Module@{State Module}}
\subsubsection[{trim\-\_\-requested}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bool} Global\-Attitude\-Variables\-::trim\-\_\-requested}}\label{group___state_ga1b90881e0b0eb5aa9cf39d0ba8ef5e0d}
The currently active attitude estimator Indicates trimming is in progress and data is being accumulated 

Definition at line 61 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga9e5b2790cd84db83278b3c8c289ea411}{\index{State Module@{State Module}!trim\-\_\-samples@{trim\-\_\-samples}}
\index{trim\-\_\-samples@{trim\-\_\-samples}!State Module@{State Module}}
\subsubsection[{trim\-\_\-samples}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int32\-\_\-t} Global\-Attitude\-Variables\-::trim\-\_\-samples}}\label{group___state_ga9e5b2790cd84db83278b3c8c289ea411}


Counter of how many accel samples have been accumulated. 



Definition at line 65 of file state\-\_\-struct.\-h.

\hypertarget{group___state_ga0c53c008608a5724b2d563fd5b560905}{\index{State Module@{State Module}!yaw\-Bias\-Rate@{yaw\-Bias\-Rate}}
\index{yaw\-Bias\-Rate@{yaw\-Bias\-Rate}!State Module@{State Module}}
\subsubsection[{yaw\-Bias\-Rate}]{\setlength{\rightskip}{0pt plus 5cm}float Global\-Attitude\-Variables\-::yaw\-Bias\-Rate}}\label{group___state_ga0c53c008608a5724b2d563fd5b560905}


Sets the rate when assuming that average yaw is zero to null out yaw error. 



Definition at line 44 of file state\-\_\-struct.\-h.

\hypertarget{group___state_gaa625401f5bc69c19b54b3171703f37f9}{\index{State Module@{State Module}!zero\-\_\-during\-\_\-arming@{zero\-\_\-during\-\_\-arming}}
\index{zero\-\_\-during\-\_\-arming@{zero\-\_\-during\-\_\-arming}!State Module@{State Module}}
\subsubsection[{zero\-\_\-during\-\_\-arming}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bool} Global\-Attitude\-Variables\-::zero\-\_\-during\-\_\-arming}}\label{group___state_gaa625401f5bc69c19b54b3171703f37f9}


Indicates to estimate the gyro bias again while arming (faster convergence) 



Definition at line 56 of file state\-\_\-struct.\-h.

