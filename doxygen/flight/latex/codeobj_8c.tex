\hypertarget{codeobj_8c}{\section{/home/jose/\-Code/gui\-Tau/flight/\-Libraries/\-Py\-Mite/vm/codeobj.c File Reference}
\label{codeobj_8c}\index{/home/jose/\-Code/gui\-Tau/flight/\-Libraries/\-Py\-Mite/vm/codeobj.\-c@{/home/jose/\-Code/gui\-Tau/flight/\-Libraries/\-Py\-Mite/vm/codeobj.\-c}}
}


Code\-Obj Type.  


\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{codeobj_8c_aa6f6a2e6b173994a159fd4b1d87baea5}{co\-\_\-load\-From\-Img} (\hyperlink{mem_8h_a9c68f72c120fc5a782d464c144aafa2b}{Pm\-Mem\-Space\-\_\-t} memspace, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group___n_a_m_e_ga7ae6d0e43244213b34de2c2b9aa30da6}{const} $\ast$$\ast$paddr, \hyperlink{obj_8h_af293479fa3f9d92b941ee7445ad3960e}{p\-Pm\-Obj\-\_\-t} $\ast$r\-\_\-pco)
\item 
\hyperlink{group___n_a_m_e_ga18028b8badbf1ea7e704ccac3c488e82}{void} \hyperlink{codeobj_8c_a5e8607ce10fa100f91ff11717300787c}{co\-\_\-r\-Set\-Code\-Img\-Addr} (\hyperlink{codeobj_8h_a0c4de4c22e1a1557978005cdbb2a351e}{p\-Pm\-Co\-\_\-t} pco, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group___n_a_m_e_ga7ae6d0e43244213b34de2c2b9aa30da6}{const} $\ast$pimg)
\item 
\hyperlink{pm_8h_a78d16e71b533f23ea2eaa9453f966d56}{Pm\-Return\-\_\-t} \hyperlink{codeobj_8c_ac1fdd3b08e931b8412cb73f1e391a52a}{no\-\_\-load\-From\-Img} (\hyperlink{mem_8h_a9c68f72c120fc5a782d464c144aafa2b}{Pm\-Mem\-Space\-\_\-t} memspace, \hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group___n_a_m_e_ga7ae6d0e43244213b34de2c2b9aa30da6}{const} $\ast$$\ast$paddr, \hyperlink{obj_8h_af293479fa3f9d92b941ee7445ad3960e}{p\-Pm\-Obj\-\_\-t} $\ast$r\-\_\-pno)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Code\-Obj Type. Code\-Obj type operations. 

Definition in file \hyperlink{codeobj_8c_source}{codeobj.\-c}.



\subsection{Function Documentation}
\hypertarget{codeobj_8c_aa6f6a2e6b173994a159fd4b1d87baea5}{\index{codeobj.\-c@{codeobj.\-c}!co\-\_\-load\-From\-Img@{co\-\_\-load\-From\-Img}}
\index{co\-\_\-load\-From\-Img@{co\-\_\-load\-From\-Img}!codeobj.c@{codeobj.\-c}}
\subsubsection[{co\-\_\-load\-From\-Img}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} co\-\_\-load\-From\-Img (
\begin{DoxyParamCaption}
\item[{{\bf Pm\-Mem\-Space\-\_\-t}}]{memspace, }
\item[{{\bf uint8\-\_\-t} {\bf const} $\ast$$\ast$}]{paddr, }
\item[{{\bf p\-Pm\-Obj\-\_\-t} $\ast$}]{r\-\_\-pco}
\end{DoxyParamCaption}
)}}\label{codeobj_8c_aa6f6a2e6b173994a159fd4b1d87baea5}
Creates a Code\-Obj by loading info from a code image in memory.

An image is a static representation of a Python object. The process of converting an object to and from an image is also called marshalling. In Py\-Mite, code images are the equivalent of .pyc files. Code images can only contain a select subset of object types (None, Int, Float, String, Slice?, Tuple, and Code\-Img). All other types (Lists, Dicts, Code\-Objs, Modules, Classes, Functions, Class\-Instances) are built at runtime.

All multibyte values are in Little Endian order (least significant byte comes first in the byte stream).

memspace and $\ast$paddr determine the start of the code image. Load the code object with values from the code image, including the names and consts tuples. Leave contents of paddr pointing one byte past end of code img.

The code image has the following structure\-: -\/type\-: 8b -\/ O\-B\-J\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-I\-M -\/size\-: 16b -\/ number of bytes the code image occupies. -\/argcount\-: 8b -\/ number of arguments to this code obj. -\/stacksz\-: 8b -\/ the maximum arg-\/stack size needed. -\/nlocals\-: 8b -\/ number of local vars in the code obj. -\/names\-: Tuple -\/ tuple of string objs. -\/consts\-: Tuple -\/ tuple of objs. -\/code\-: 8b\mbox{[}\mbox{]} -\/ bytecode array.


\begin{DoxyParams}{Parameters}
{\em memspace} & memory space containing image \\
\hline
{\em paddr} & ptr to ptr to code img in memspace return by reference\-: paddr points one byte past end of code img \\
\hline
{\em r\-\_\-pco} & Return arg. New code object with fields filled in. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Return status 
\end{DoxyReturn}


Definition at line 33 of file codeobj.\-c.

\hypertarget{codeobj_8c_a5e8607ce10fa100f91ff11717300787c}{\index{codeobj.\-c@{codeobj.\-c}!co\-\_\-r\-Set\-Code\-Img\-Addr@{co\-\_\-r\-Set\-Code\-Img\-Addr}}
\index{co\-\_\-r\-Set\-Code\-Img\-Addr@{co\-\_\-r\-Set\-Code\-Img\-Addr}!codeobj.c@{codeobj.\-c}}
\subsubsection[{co\-\_\-r\-Set\-Code\-Img\-Addr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} co\-\_\-r\-Set\-Code\-Img\-Addr (
\begin{DoxyParamCaption}
\item[{{\bf p\-Pm\-Co\-\_\-t}}]{pco, }
\item[{{\bf uint8\-\_\-t} {\bf const} $\ast$}]{pimg}
\end{DoxyParamCaption}
)}}\label{codeobj_8c_a5e8607ce10fa100f91ff11717300787c}
Recursively sets image address of the C\-O and all its nested C\-Os in its constant pool. This is done so that an image that was received during an interactive session will persist as long as any of its C\-Os/funcs/objects is still alive.


\begin{DoxyParams}{Parameters}
{\em pco} & Pointer to root code object whose images are set \\
\hline
{\em pimg} & Pointer to very top of code image (Pmode\-Img\-Obj) \\
\hline
\end{DoxyParams}


Definition at line 142 of file codeobj.\-c.

\hypertarget{codeobj_8c_ac1fdd3b08e931b8412cb73f1e391a52a}{\index{codeobj.\-c@{codeobj.\-c}!no\-\_\-load\-From\-Img@{no\-\_\-load\-From\-Img}}
\index{no\-\_\-load\-From\-Img@{no\-\_\-load\-From\-Img}!codeobj.c@{codeobj.\-c}}
\subsubsection[{no\-\_\-load\-From\-Img}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Pm\-Return\-\_\-t} no\-\_\-load\-From\-Img (
\begin{DoxyParamCaption}
\item[{{\bf Pm\-Mem\-Space\-\_\-t}}]{memspace, }
\item[{{\bf uint8\-\_\-t} {\bf const} $\ast$$\ast$}]{paddr, }
\item[{{\bf p\-Pm\-Obj\-\_\-t} $\ast$}]{r\-\_\-pno}
\end{DoxyParamCaption}
)}}\label{codeobj_8c_ac1fdd3b08e931b8412cb73f1e391a52a}
Creates a Native code object by loading a native image.

An image is a static representation of a Python object. A native image is much smaller than a regular image because only two items of data are needed after the type\-: the number of args the func expects and the index into the native function table. A reference to the image is not needed since it is just as efficient to store the info in R\-A\-M as it is to store a pointer and memspace value.

memspace and $\ast$paddr determine the start of the native image. Loads the argcount and the func index from the native object. Leaves contents of paddr pointing one byte past end of code img.

The native image has the following structure\-: -\/type\-: 8b -\/ O\-B\-J\-\_\-\-T\-Y\-P\-E\-\_\-\-C\-I\-M -\/argcount\-: 8b -\/ number of arguments to this code obj. -\/code\-: 16b -\/ index into native function table.


\begin{DoxyParams}{Parameters}
{\em memspace} & memory space containing image \\
\hline
{\em paddr} & ptr to ptr to code img in memspace (return) \\
\hline
{\em r\-\_\-pno} & Return by reference, new code object \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Return status 
\end{DoxyReturn}


Definition at line 162 of file codeobj.\-c.

